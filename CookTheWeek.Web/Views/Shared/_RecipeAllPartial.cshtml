@using CookTheWeek.Services.Interfaces
@using CookTheWeek.Web.Infrastructure.Extensions
@model RecipeAllViewModel
@inject IRecipeService RecipeService
@{
    string userId = User.GetId();
    string id = Model.Id;
    bool isInFavourites = await this.RecipeService.IsFavouriteRecipeForUserByIdAsync(id, userId);
    string url = "https://localhost:7279/api/favouriteRecipe/";
}

<div class="col justify-content-center" style="max-width:30rem;">
    <div class="card mb-3 rounded-5 h-100">
        <div class="position-relative">
            <img src="@Model.ImageUrl" class="card-img-top" alt="Recipe Image" style="width: 100%; height:13rem;object-fit:cover;">
            @if(!string.IsNullOrEmpty(userId))
            {
                <button class="add-to-favorites-button position-absolute top-0 end-0 m-3">
                @if(isInFavourites)
                {
                    <i class="fas fa-heart"></i>
                }
                else
                {
                    <i class="far fa-heart"></i>
                }
                </button>
            }  
        </div>
        <div class="card-body pt-1">
            <div class="row mb-1">
                <div class="col-md-6">
                    <span class="badge bg-primary text-light">@Model.Category.Name</span>
                </div>
            </div>
            <div class="d-flex justify-content-between pb-3">
                <div>
                    <i class="fa-solid fa-utensils"></i> <span>@Model.Servings</span>
                </div>   
                <div>
                    <i class="fa-solid fa-clock"></i> <span>@Model.CookingTime</span>
                </div>
            </div>            
            <div class="d-grid pb-2">
                <h5 class="card-title">@Model.Title</h5>   
                <a class="d-block" asp-asp-area="" asp-asp-controller="Recipe" asp-action="Details" asp-route-id="@Model.Id" class="btn btn-primary">View Recipe</a>
            </div>              
        </div>
    </div>
</div>

@section Scripts{
    <script>
        $(function () {
            $('.add-to-favorites-button').click(toggleLikeIcon);
        });      

        function toggleFavourites(event) {
            debugger;
            event.preventDefault();
            var $button = $(event.currentTarget);
            // Define the type of action needed and update url accordingly
            @if(isInFavourites)
            {
                url += "remove";
            }
            else
            {
                url += "add";
            }
            $.ajax({
                    url: @url,
                    method: 'POST',
                    data: {
                        "id": '@id',
                        "userId": '@userId'
                    },
                    success: function (response) {
                        // Handle success response
                        console.log('Recipe added to favorites successfully!');
                        $button.find('i').toggleClass('far fas');
                    },
                    error: function (xhr, status, error) {
                        // Handle error
                        console.error('Error adding recipe to favorites:', error);
                    }
                });
            }
    </script>
}



